<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ DES | Ù¾Ø±ÙˆÚ˜Ù‡ Ø¹Ù„ÛŒâ€ŒØ§Ú©Ø¨Ø± Ø¬ÙˆØ§Ù†Ù…Ø±Ø¯</title>
<link href="https://cdn.fontcdn.ir/Font/Persian/Vazir/Vazir.css" rel="stylesheet">
<style>
body{font-family:"Vazir",sans-serif;background:#f7f9fb;margin:0;direction:rtl}
.container{max-width:720px;margin:3rem auto;background:#fff;padding:2rem;border-radius:14px;box-shadow:0 3px 16px rgba(0,0,0,.12)}
h1{text-align:center;color:#007f9b;margin-bottom:1.5rem}
label{font-weight:bold;display:block;margin-top:1.1rem;margin-bottom:.3rem}
input,textarea,select{width:100%;padding:.6rem;border:1px solid #ccc;border-radius:6px;font-size:.95rem;transition:.25s}
input.invalid,textarea.invalid,select.invalid{border-color:#e74c3c;background:#fdecea}
.hint{font-size:0.83rem;color:#777;margin-top:3px}
.error-text{font-size:0.83rem;color:#e74c3c;margin-top:4px;display:none}
button{border:none;padding:.6rem 1rem;border-radius:8px;color:#fff;font-size:.95rem;cursor:pointer}
.btn-encrypt{background:#007f9b}.btn-decrypt{background:#a372f3}
.btn-encrypt:hover,.btn-decrypt:hover{opacity:.9}
button#copyOutput{background:#21a179}
button#copyOutput:hover{background:#1a8c68}
footer{text-align:center;color:#777;margin-top:2rem;font-size:0.83rem}
@media(max-width:620px){.container{margin:1rem;padding:1.3rem}}
#iv{text-align:left;direction:ltr;}
</style>
</head>

<body>
<div class="container">
  <h1>ğŸ’  Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ø±ÙˆØ´ DES</h1>
  <form id="cryptoForm" action="/process" method="POST" novalidate>

    <!-- Plaintext -->
    <label for="plaintext">ğŸ“ Ù…ØªÙ† ÙˆØ±ÙˆØ¯ÛŒ (Plaintext)</label>
    <textarea id="plaintext" name="plaintext" required>{{ plaintext }}</textarea>
    <div class="hint" id="hint-plaintext">ÙÙ‚Ø· Ø§Ø² Ø­Ø±ÙˆÙ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒØŒ Ø§Ø¹Ø¯Ø§Ø¯ Ùˆ Ø¹Ù„Ø§Ø¦Ù… Ù…Ø¬Ø§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</div>
    <div class="error-text" id="error-plaintext"></div>

    <!-- Block size -->
    <label for="block_size">ğŸ“¦ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø¨Ù„ÙˆÚ© (Block Size)</label>
    <select id="block_size" name="block_size">
      <option value="8"  {{ 'selected' if block_size==8  }}>8</option>
      <option value="16" {{ 'selected' if block_size==16 }}>16</option>
      <option value="32" {{ 'selected' if block_size==32 }}>32</option>
      <option value="64" {{ 'selected' if block_size==64 }}>64</option>
      <option value="128"{{ 'selected' if block_size==128 }}>128</option>
    </select>
    <div class="hint" id="hint-block">Ø·ÙˆÙ„ Ø¨Ù„ÙˆÚ© Ø¨Ø§ÛŒØ¯ Ø¹Ø¯Ø¯ÛŒ Ø²ÙˆØ¬ Ùˆ Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ù…ØªÙ† Ø¨Ø§Ø´Ø¯.</div>
    <div class="error-text" id="error-block"></div>

    <!-- Key -->
    <label for="key">ğŸ”’ Ú©Ù„ÛŒØ¯ DES (Key)</label>
    <input 
      type="text" id="key" name="key"
      value="{{ key }}"
      required
      maxlength="7"
      pattern=".{1,7}"
      title="Ø·ÙˆÙ„ Ú©Ù„ÛŒØ¯ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† Û± ØªØ§ Û· Ú©Ø§Ø±Ø§Ú©ØªØ± (Ø­Ø¯Ø§Ú©Ø«Ø± ÛµÛ¶ Ø¨ÛŒØª) Ø¨Ø§Ø´Ø¯."
      placeholder="Ú©Ù„ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Û± ØªØ§ Û· Ú©Ø§Ø±Ø§Ú©ØªØ±)"
    />
    <div class="hint" id="key-hint">Ú©Ù„ÛŒØ¯ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø§Ø² Û± ØªØ§ Û· Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯ (DES = ÛµÛ¶ Ø¨ÛŒØª Ù…Ø¤Ø«Ø±).</div>
    <div class="error-text" id="error-key"></div>

    <!-- IV -->
    <label for="iv">ğŸ”¹ Ø¨Ø±Ø¯Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡ (IV)</label>
    <input type="text" id="iv" name="iv" value="{{ iv }}" required placeholder="Ù…Ø«Ù„Ø§Ù‹ 12345678" />
    <div class="hint" id="hint-iv">
      Ø¯Ø± Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ CBC / CFB / OFB Ù„Ø§Ø²Ù… Ø§Ø³Øª. Ø·ÙˆÙ„ IV Ø¨Ø§ÛŒØ¯ Ø¨Ø±Ø§Ø¨Ø± Ø¨Ø§ (Block Size Ã· 8) Ø¨Ø§Ø´Ø¯.
    </div>
    <div class="error-text" id="error-iv"></div>

    <!-- Mode -->
    <label for="mode">ğŸ§© Ø­Ø§Ù„Øª Ø§Ø¬Ø±Ø§ (Mode)</label>
    <select id="mode" name="mode">
      <option value="ECB" {{ 'selected' if mode=='ECB' }}>ECB</option>
      <option value="CBC" {{ 'selected' if mode=='CBC' }}>CBC</option>
      <option value="CFB" {{ 'selected' if mode=='CFB' }}>CFB</option>
      <option value="OFB" {{ 'selected' if mode=='OFB' }}>OFB</option>
      <option value="CTR" {{ 'selected' if mode=='CTR' }}>CTR</option>
    </select>
    <div class="hint" id="mode-hint">
      Ù†ÙˆØ¹ Ù…Ø¯ Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.  
      Ø¯Ø± Ø­Ø§Ù„Øª <b>CTR</b> Ø§Ø² Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø¨Ù‡â€ŒØ¬Ø§ÛŒ IV Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø·ÙˆÙ„ Ø¢Ù† Ø¨Ø§ÛŒØ¯ Ù…Ø«Ù„ IV Ø¨Ø§Ø´Ø¯.
    </div>

    <!-- Rounds -->
    <label for="rounds">ğŸ” ØªØ¹Ø¯Ø§Ø¯ Ø¯ÙˆØ±Ù‡Ø§ (Rounds)</label>
    <input type="number" id="rounds" name="rounds" value="{{ rounds }}" min="8" max="32" required />
    <div class="hint" id="hint-rounds">Ø¹Ø¯Ø¯ Ø¨ÛŒÙ† Û¸ ØªØ§ Û³Û² (Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Û±Û¶ Ø¨Ø±Ø§ÛŒ DES Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯).</div>
    <div class="error-text" id="error-rounds"></div>

    <!-- Buttons -->
    <div style="display:flex;gap:1rem;margin-top:1.3rem;flex-wrap:wrap">
      <button type="button" class="btn-encrypt" onclick="submitForm('encrypt')">Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ</button>
      <button type="button" class="btn-decrypt" onclick="submitForm('decrypt')">Ø±Ù…Ø²Ú¯Ø´Ø§ÛŒÛŒ</button>
    </div>

    <!-- Result -->
    <label for="result" style="margin-top:1rem">Ù†ØªÛŒØ¬Ù‡:</label>
    <div style="display:flex;gap:.5rem;align-items:center;flex-wrap:wrap">
      <textarea id="result" readonly rows="4" style="flex:1">{{ result }}</textarea>
      <button type="button" id="copyOutput">ğŸ“‹ Ú©Ù¾ÛŒ</button>
    </div>
    <div id="copyMessage" class="hint" style="color:#21a179;margin-top:.4rem;"></div>
  </form>
  <footer>Â© Ø¹Ù„ÛŒâ€ŒØ§Ú©Ø¨Ø± Ø¬ÙˆØ§Ù†Ù…Ø±Ø¯ â€“ Ù¾Ø±ÙˆÚ˜Ù‡ Ø§Ù…Ù†ÛŒØª Ø´Ø¨Ú©Ù‡</footer>
</div>

<script>
const asciiRegex=/^[\x20-\x7E]*$/;
const form=document.getElementById('cryptoForm');
const fields={
  plaintext:document.getElementById('plaintext'),
  key:document.getElementById('key'),
  iv:document.getElementById('iv'),
  rounds:document.getElementById('rounds'),
  block:document.getElementById('block_size'),
  mode:document.getElementById('mode')
};

// Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ÙˆØ±ÙˆØ¯ Ø­Ø±ÙˆÙ ÙØ§Ø±Ø³ÛŒ
['plaintext','key','iv'].forEach(id=>{
  const el=fields[id];
  el.addEventListener('keypress',e=>{if(!asciiRegex.test(e.key)) e.preventDefault();});
  el.addEventListener('paste',e=>{
    const pasted=(e.clipboardData||window.clipboardData).getData('text');
    if(!asciiRegex.test(pasted)) e.preventDefault();
  });
});

// Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø·ÙˆÙ„ Ú©Ù„ÛŒØ¯ Ø¨ÛŒÙ† Û± ØªØ§ Û·
fields.key.addEventListener('input',()=>{
  const val=fields.key.value;
  if(val.length>7){fields.key.value=val.slice(0,7);}
});

// Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø¨Ù„ÙˆÚ©
fields.plaintext.addEventListener('input',()=>{
  const len=fields.plaintext.value.length;
  const hint=document.getElementById('hint-block');
  if(len>0){
    let nearest=[8,16,32,64,128].find(v=>v>=len*8)||128;
    hint.innerText=`Ø·ÙˆÙ„ Ù…ØªÙ† ${len} Ú©Ø§Ø±Ø§Ú©ØªØ± Ø§Ø³Øª â†’ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ù„ÙˆÚ© ${nearest}.`;
  } else hint.innerText="Ø·ÙˆÙ„ Ø¨Ù„ÙˆÚ© Ø¨Ø§ÛŒØ¯ Ø¹Ø¯Ø¯ÛŒ Ø²ÙˆØ¬ Ùˆ Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ù…ØªÙ† Ø¨Ø§Ø´Ø¯.";
});

function submitForm(operation){
  if(fields.key.value.length<1||fields.key.value.length>7){
    alert("âŒ Ø·ÙˆÙ„ Ú©Ù„ÛŒØ¯ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† Û± ØªØ§ Û· Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯ (Ø­Ø¯Ø§Ú©Ø«Ø± ÛµÛ¶ Ø¨ÛŒØª).");
    fields.key.focus();
    return;
  }
  const opInput=document.createElement('input');
  opInput.type='hidden';opInput.name='operation';opInput.value=operation;
  form.appendChild(opInput);
  form.submit();
}

document.getElementById('copyOutput').addEventListener('click',async()=>{
  await navigator.clipboard.writeText(document.getElementById('result').value);
  const msg=document.getElementById('copyMessage');
  msg.innerText="âœ… Ù†ØªÛŒØ¬Ù‡ Ú©Ù¾ÛŒ Ø´Ø¯!";
  setTimeout(()=>msg.innerText="",3000);
});
</script>
</body>
</html>
