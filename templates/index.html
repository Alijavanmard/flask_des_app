<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ DES | Ù¾Ø±ÙˆÚ˜Ù‡ Ø¹Ù„ÛŒâ€ŒØ§Ú©Ø¨Ø± Ø¬ÙˆØ§Ù†Ù…Ø±Ø¯</title>
<link href="https://cdn.fontcdn.ir/Font/Persian/Vazir/Vazir.css" rel="stylesheet">
<style>
body{font-family:"Vazir",sans-serif;background:#f7f9fb;margin:0;direction:rtl}
.container{max-width:720px;margin:3rem auto;background:#fff;padding:2rem;border-radius:14px;box-shadow:0 3px 16px rgba(0,0,0,.12)}
h1{text-align:center;color:#007f9b;margin-bottom:1.5rem}
label{font-weight:bold;display:block;margin-top:1.1rem;margin-bottom:.3rem}
input,textarea,select{width:100%;padding:.6rem;border:1px solid #ccc;border-radius:6px;font-size:.95rem;transition:.25s}
input.invalid,textarea.invalid,select.invalid{border-color:#e74c3c;background:#fdecea}
.hint{font-size:0.83rem;color:#777;margin-top:3px}
.error-text{font-size:0.83rem;color:#e74c3c;margin-top:4px;display:none}
button{border:none;padding:.6rem 1rem;border-radius:8px;color:#fff;font-size:.95rem;cursor:pointer}
.btn-encrypt{background:#007f9b}.btn-decrypt{background:#a372f3}
.btn-encrypt:hover,.btn-decrypt:hover{opacity:.9}
button#copyOutput{background:#21a179}
button#copyOutput:hover{background:#1a8c68}
footer{text-align:center;color:#777;margin-top:2rem;font-size:0.83rem}
@media(max-width:620px){.container{margin:1rem;padding:1.3rem}}
#iv{text-align:left;direction:ltr;} /* IV Ú†Ù¾â€ŒØ¨Ù‡â€ŒØ±Ø§Ø³Øª */
</style>
</head>

<body>
<div class="container">
  <h1>ğŸ’  Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ø±ÙˆØ´ DES</h1>
  <form id="cryptoForm" action="/process" method="POST" novalidate>

    <!-- Plaintext -->
    <label for="plaintext">ğŸ“ Ù…ØªÙ† ÙˆØ±ÙˆØ¯ÛŒ (Plaintext)</label>
    <textarea id="plaintext" name="plaintext" required>{{ plaintext }}</textarea>
    <div class="hint" id="hint-plaintext">ÙÙ‚Ø· Ø§Ø² Ø­Ø±ÙˆÙ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒØŒ Ø§Ø¹Ø¯Ø§Ø¯ Ùˆ Ø¹Ù„Ø§Ø¦Ù… Ù…Ø¬Ø§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</div>
    <div class="error-text" id="error-plaintext"></div>

    <!-- Block size -->
    <label for="block_size">ğŸ“¦ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø¨Ù„ÙˆÚ© (Block Size)</label>
    <select id="block_size" name="block_size">
      <option value="8"  {{ 'selected' if block_size==8  }}>8</option>
      <option value="16" {{ 'selected' if block_size==16 }}>16</option>
      <option value="32" {{ 'selected' if block_size==32 }}>32</option>
      <option value="64" {{ 'selected' if block_size==64 }}>64</option>
      <option value="128"{{ 'selected' if block_size==128 }}>128</option>
    </select>
    <div class="hint" id="hint-block">Ø·ÙˆÙ„ Ø¨Ù„ÙˆÚ© Ø¨Ø§ÛŒØ¯ Ø¹Ø¯Ø¯ÛŒ Ø²ÙˆØ¬ Ùˆ Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ù…ØªÙ† Ø¨Ø§Ø´Ø¯.</div>
    <div class="error-text" id="error-block"></div>

    <!-- Key length -->
    <label for="key_length">ğŸ”‘ Ø·ÙˆÙ„ Ú©Ù„ÛŒØ¯ (Key Length)</label>
    <select id="key_length" name="key_length">
      <option value="8"   {{ 'selected' if key_length==8 }}>8</option>
      <option value="16"  {{ 'selected' if key_length==16 }}>16</option>
      <option value="32"  {{ 'selected' if key_length==32 }}>32</option>
      <option value="64"  {{ 'selected' if key_length==64 }}>64</option>
      <option value="128" {{ 'selected' if key_length==128 }}>128</option>
    </select>
    <div class="hint" id="hint-keylen">Ù‡Ø± Û¸ Ø¨ÛŒØª = Û± Ú©Ø§Ø±Ø§Ú©ØªØ±ØŒ Ù…Ø«Ù„Ø§Ù‹ Ø¨Ø±Ø§ÛŒ Û¶Û´ Ø¨ÛŒØª Ø¨Ø§ÛŒØ¯ Û¸ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯.</div>
    <div class="error-text" id="error-keylen"></div>

    <!-- Key -->
    <label for="key">ğŸ”’ Ù…Ù‚Ø¯Ø§Ø± Ú©Ù„ÛŒØ¯ (Key)</label>
    <input type="text" id="key" name="key" value="{{ key }}" required />
    <div class="hint" id="key-hint">Ú©Ù„ÛŒØ¯ Ø¨Ø§ÛŒØ¯ Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ø·ÙˆÙ„ Ú©Ù„ÛŒØ¯ Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯.</div>
    <div class="error-text" id="error-key"></div>

    <!-- IV -->
    <label for="iv">ğŸ”¹ Ø¨Ø±Ø¯Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡ (IV)</label>
    <input type="text" id="iv" name="iv" value="{{ iv }}" required placeholder="Ù…Ø«Ù„Ø§Ù‹ 12345678" />
    <div class="hint" id="hint-iv">
      Ø¯Ø± Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ CBC / CFB / OFB Ù„Ø§Ø²Ù… Ø§Ø³Øª. Ø·ÙˆÙ„ IV Ø¨Ø§ÛŒØ¯ Ø¨Ø±Ø§Ø¨Ø± Ø¨Ø§ (Block Size Ã· 8) Ø¨Ø§Ø´Ø¯.
    </div>
    <div class="error-text" id="error-iv"></div>

    <!-- Mode -->
    <label for="mode">ğŸ§© Ø­Ø§Ù„Øª Ø§Ø¬Ø±Ø§ (Mode)</label>
    <select id="mode" name="mode">
      <option value="ECB" {{ 'selected' if mode=='ECB' }}>ECB</option>
      <option value="CBC" {{ 'selected' if mode=='CBC' }}>CBC</option>
      <option value="CFB" {{ 'selected' if mode=='CFB' }}>CFB</option>
      <option value="OFB" {{ 'selected' if mode=='OFB' }}>OFB</option>
      <option value="CTR" {{ 'selected' if mode=='CTR' }}>CTR</option>
    </select>
    <div class="hint" id="mode-hint">
      Ù†ÙˆØ¹ Ù…Ø¯ Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.  
      Ø¯Ø± Ø­Ø§Ù„Øª <b>CTR</b> Ø§Ø² Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø¨Ù‡â€ŒØ¬Ø§ÛŒ IV Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø·ÙˆÙ„ Ø¢Ù† Ø¨Ø§ÛŒØ¯ Ù…Ø«Ù„ IV Ø¨Ø§Ø´Ø¯.
    </div>

    <!-- Rounds -->
    <label for="rounds">ğŸ” ØªØ¹Ø¯Ø§Ø¯ Ø¯ÙˆØ±Ù‡Ø§ (Rounds)</label>
    <input type="number" id="rounds" name="rounds" value="{{ rounds }}" min="8" max="32" required />
    <div class="hint" id="hint-rounds">Ø¹Ø¯Ø¯ Ø¨ÛŒÙ† Û¸ ØªØ§ Û³Û² (Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Û±Û¶ Ø¨Ø±Ø§ÛŒ DES Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯).</div>
    <div class="error-text" id="error-rounds"></div>

    <!-- Buttons -->
    <div style="display:flex;gap:1rem;margin-top:1.3rem;flex-wrap:wrap">
      <button type="button" class="btn-encrypt" onclick="submitForm('encrypt')">Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ</button>
      <button type="button" class="btn-decrypt" onclick="submitForm('decrypt')">Ø±Ù…Ø²Ú¯Ø´Ø§ÛŒÛŒ</button>
    </div>

    <!-- Result -->
    <label for="result" style="margin-top:1rem">Ù†ØªÛŒØ¬Ù‡:</label>
    <div style="display:flex;gap:.5rem;align-items:center;flex-wrap:wrap">
      <textarea id="result" readonly rows="4" style="flex:1">{{ result }}</textarea>
      <button type="button" id="copyOutput">ğŸ“‹ Ú©Ù¾ÛŒ</button>
    </div>
    <div id="copyMessage" class="hint" style="color:#21a179;margin-top:.4rem;"></div>
  </form>
  <footer>Â© Ø¹Ù„ÛŒâ€ŒØ§Ú©Ø¨Ø± Ø¬ÙˆØ§Ù†Ù…Ø±Ø¯ â€“ Ù¾Ø±ÙˆÚ˜Ù‡ Ø§Ù…Ù†ÛŒØª Ø´Ø¨Ú©Ù‡</footer>
</div>

<script>
const asciiRegex=/^[\x20-\x7E]*$/;
const form=document.getElementById('cryptoForm');
const fields={
  plaintext:document.getElementById('plaintext'),
  key:document.getElementById('key'),
  iv:document.getElementById('iv'),
  rounds:document.getElementById('rounds'),
  keyLength:document.getElementById('key_length'),
  block:document.getElementById('block_size'),
  mode:document.getElementById('mode')
};

// âœ³ï¸ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªØ§ÛŒÙ¾ / Ú†Ø³Ø¨Ø§Ù†Ø¯Ù† ÙØ§Ø±Ø³ÛŒ Ø¯Ø± ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§
['plaintext','key','iv'].forEach(id=>{
  const el=fields[id];
  el.addEventListener('keypress',e=>{if(!asciiRegex.test(e.key)) e.preventDefault();});
  el.addEventListener('paste',e=>{
    const pasted=(e.clipboardData||window.clipboardData).getData('text');
    if(!asciiRegex.test(pasted)) e.preventDefault();
  });
});

// âœ³ï¸ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ø·ÙˆÙ„ Ù…ØªÙ† Ùˆ Ø¨Ù„ÙˆÚ©
fields.plaintext.addEventListener('input',()=>{
  const len=fields.plaintext.value.length;
  const hint=document.getElementById('hint-block');
  if(len>0){
    let nearest=[8,16,32,64,128].find(v=>v>=len*8) || 128;
    hint.innerText=`Ø·ÙˆÙ„ Ù…ØªÙ† Ø´Ù…Ø§ ${len} Ú©Ø§Ø±Ø§Ú©ØªØ± Ø§Ø³Øª. Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø¨Ù„ÙˆÚ© ${nearest} Ø§Ù†ØªØ®Ø§Ø¨ Ø´ÙˆØ¯.`;
  } else hint.innerText="Ø·ÙˆÙ„ Ø¨Ù„ÙˆÚ© Ø¨Ø§ÛŒØ¯ Ø¹Ø¯Ø¯ÛŒ Ø²ÙˆØ¬ Ùˆ Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ù…ØªÙ† Ø¨Ø§Ø´Ø¯.";
});

// âœ³ï¸ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ø§Ø³Ø§Ø³ Ø·ÙˆÙ„ Ú©Ù„ÛŒØ¯
fields.key.addEventListener('input',()=>{
  const bits=parseInt(fields.keyLength.value);
  const need=bits/8;
  const cur=fields.key.value.length;
  const hint=document.getElementById('hint-keylen');
  if(cur!==need){
    hint.innerText=`Ú©Ù„ÛŒØ¯ ÙØ¹Ù„ÛŒ ${cur} Ú©Ø§Ø±Ø§Ú©ØªØ± Ø§Ø³Øª Ø§Ù…Ø§ Ø¨Ø§ÛŒØ¯ ${need} Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯.`;
  } else {hint.innerText=`âœ… Ø·ÙˆÙ„ Ú©Ù„ÛŒØ¯ Ù…Ù†Ø§Ø³Ø¨ (${need} Ú©Ø§Ø±Ø§Ú©ØªØ±).`;}
});
// Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ÙˆØ±ÙˆØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² Ø­Ø¯ Ù…Ø¬Ø§Ø² Ø·ÙˆÙ„ Ú©Ù„ÛŒØ¯
fields.key.addEventListener('input',()=>{
  const bits=parseInt(fields.keyLength.value);
  const need=bits/8;
  if(fields.key.value.length>need){
    fields.key.value=fields.key.value.substring(0,need);
  }
});

// âœ³ï¸ Ú©Ù†ØªØ±Ù„ IV Ø¨Ø± Ø§Ø³Ø§Ø³ mode
fields.mode.addEventListener('change',()=>{
  const mode=fields.mode.value;
  const hintIv=document.getElementById('hint-iv');
  const lblIv=document.querySelector('label[for="iv"]');
  if(mode==='ECB'){
    fields.iv.disabled=true;
    fields.iv.value='';
    lblIv.style.opacity='0.5';
    hintIv.innerText='Ø¯Ø± Ø­Ø§Ù„Øª ECB Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ IV ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ Ùˆ ÙˆØ±ÙˆØ¯ Ù…Ù…Ù†ÙˆØ¹ Ø§Ø³Øª.';
  } else if(mode==='CTR'){
    fields.iv.disabled=false;
    lblIv.style.opacity='1';
    hintIv.innerHTML='Ø¯Ø± Ø­Ø§Ù„Øª CTR Ø§Ø² Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ (Counter) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø·ÙˆÙ„ Ø¢Ù† Ø¨Ø§ÛŒØ¯ Ø¨Ø±Ø§Ø¨Ø± (Block Size Ã· 8) Ø¨Ø§Ø´Ø¯.';
  } else {
    fields.iv.disabled=false;
    lblIv.style.opacity='1';
    hintIv.innerText='Ø¯Ø± Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ CBCØŒ CFBØŒ OFB Ù„Ø§Ø²Ù… Ø§Ø³Øª. Ø·ÙˆÙ„ IV Ø¨Ø§ÛŒØ¯ Ø¨Ø±Ø§Ø¨Ø± Ø¨Ø§ (Block Size Ã· 8) Ø¨Ø§Ø´Ø¯.';
  }
});

// âœ³ï¸ Ú©Ù†ØªØ±Ù„ IV Ù‡Ù†Ú¯Ø§Ù… ØªØ§ÛŒÙ¾
fields.iv.addEventListener('input',()=>{
  const blockBits=parseInt(fields.block.value);
  const need=blockBits/8;
  const val=fields.iv.value;
  if(!asciiRegex.test(val)){
    setError('error-iv','IV ÙÙ‚Ø· Ø¨Ø§ÛŒØ¯ Ø´Ø§Ù…Ù„ Ø­Ø±ÙˆÙ Ùˆ Ø§Ø¹Ø¯Ø§Ø¯ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ø§Ø´Ø¯.');
  }else if(val.length!==need){
    setError('error-iv',`Ø·ÙˆÙ„ IV Ø¨Ø§ÛŒØ¯ ${need} Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯ (ÙØ¹Ù„ÛŒ ${val.length}).`);
  } else clearError('error-iv');
});

// âœ³ï¸ Ú©Ù†ØªØ±Ù„ Ù…Ø­Ø¯ÙˆØ¯Ù‡ rounds
fields.rounds.addEventListener('input',()=>{
  let val=parseInt(fields.rounds.value);
  const hint=document.getElementById('hint-rounds');
  if(val<8){fields.rounds.value=8; val=8;}
  if(val>32){fields.rounds.value=32; val=32;}
  hint.innerText=`ØªØ¹Ø¯Ø§Ø¯ Ø¯ÙˆØ±Ù‡Ø§ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯ Ø±ÙˆÛŒ ${val}. (Ø¨Ø§Ø²Ù‡Ù” Ù…Ø¬Ø§Ø² Û¸ ØªØ§ Û³Û² Ø§Ø³Øª)`;
});

// ØªÙˆØ§Ø¨Ø¹ Ø§Ø² Ù‚Ø¨Ù„ Ù…ÙˆØ¬ÙˆØ¯:
function setError(id,msg){const el=document.getElementById(id);el.innerText=msg;el.style.display='block';}
function clearError(id){document.getElementById(id).style.display='none';}

function validateAsciiField(fld,errId,label){
  if(!asciiRegex.test(fld.value)){
    fld.classList.add('invalid');setError(errId,`${label} Ø¨Ø§ÛŒØ¯ ÙÙ‚Ø· Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ø§Ø´Ø¯.`);return false;
  }fld.classList.remove('invalid');clearError(errId);return true;
}
function validateKeyLength(){
  const bits=parseInt(fields.keyLength.value);
  const need=bits/8;
  const cur=fields.key.value.length;
  if(cur!==need){setError('error-key',`Ø·ÙˆÙ„ Ú©Ù„ÛŒØ¯ Ø¨Ø§ÛŒØ¯ ${need} Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯ (ÙØ¹Ù„ÛŒ ${cur}).`);return false;}
  clearError('error-key');return true;
}
function validateIV(){
  const mode=fields.mode.value;
  if(mode==='ECB') return true;
  const blockBits=parseInt(fields.block.value);
  const need=blockBits/8;
  const val=fields.iv.value.trim();
  if(!asciiRegex.test(val)){setError('error-iv','IV ÙÙ‚Ø· Ø¨Ø§ÛŒØ¯ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ø§Ø´Ø¯.');return false;}
  if(val.length!==need){setError('error-iv',`Ø·ÙˆÙ„ IV Ø¨Ø§ÛŒØ¯ ${need} Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯ (ÙØ¹Ù„ÛŒ ${val.length}).`);return false;}
  clearError('error-iv');return true;
}

// âœ³ï¸ Ù…Ø¹ØªØ¨Ø±Ø³Ø§Ø²ÛŒ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ù†Ù‡Ø§ÛŒÛŒ
function submitForm(operation){
  const valid=
    validateAsciiField(fields.plaintext,'error-plaintext','Ù…ØªÙ†') &&
    validateKeyLength() &&
    validateIV();
  if(!valid){alert('âŒ Ù„Ø·ÙØ§Ù‹ Ø®Ø·Ø§Ù‡Ø§ Ø±Ø§ Ø¨Ø±Ø·Ø±Ù Ú©Ù†ÛŒØ¯.');return;}
  const opInput=document.createElement('input');
  opInput.type='hidden';opInput.name='operation';opInput.value=operation;
  form.appendChild(opInput);form.submit();
}

// Ø¯Ú©Ù…Ù‡ Ú©Ù¾ÛŒ Ù†ØªÛŒØ¬Ù‡
document.getElementById('copyOutput').addEventListener('click',async()=>{
  await navigator.clipboard.writeText(document.getElementById('result').value);
  const msg=document.getElementById('copyMessage');
  msg.innerText="âœ… Ù†ØªÛŒØ¬Ù‡ Ú©Ù¾ÛŒ Ø´Ø¯!";setTimeout(()=>msg.innerText="",3000);
});
</script>
</body>
</html>
